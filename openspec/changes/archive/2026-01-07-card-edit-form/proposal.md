# Proposal: Card Edit Form

## Status

**complete**

## Context

Текущая реализация имеет проблему: кнопка редактирования карточки (`CardItem.vue`) вызывает событие
`@edit`, но связанная функциональность использует устаревший модальный редактор (`CardEditorModal`),
который не соответствует современной UX-концепции приложения.

Текущие проблемы:

1. **Отсутствует визуальная обратная связь** — после редактирования карточки пользователь не видит,
   какую карточку он изменил (нет анимации, нет прокрутки к отредактированной карточке)
2. **Отсутствует аналогичный UX для добавления** — форма добавления (`QuickAddCard`) тоже не имеет
   функционала прокрутки к добавленной карточке и визуального выделения
3. **Плохой UX на мобильных устройствах** — при редактировании/добавлении карточки список карточек не
   управляется автоматически (не прокручивается)

## Why

Пользователям необходима чёткая визуальная подтверждение того, какая карточка была создана или
отредактирована. Без этой обратной связи неясно, успешно ли выполнена операция и где именно в списке
находится изменённая карточка. Это особенно критично на мобильных устройствах, где список может быть
длинным, а пользователь теряет контекст после закрытия модального окна.

Дополнительно, при редактировании карточки её содержимое меняется, что делает предыдущие метрики
обучения FSRS неактуальными. Сброс прогресса обеспечивает, что пользователь заново изучит
изменённый материал с правильными интервалами повторения.

## Proposal

Реализовать функционал редактирования карточки через существующую модалку `CardEditorModal` с расширениями:

1. **Сброс прогресса карточки** при сохранении (карточка становится новой)
2. **Визуальная обратная связь** после сохранения:
   - Прокрутка к отредактированной/добавленной карточке
   - Анимация `bounce-in-bck` для выделения карточки

Также необходимо расширить функционал формы добавления (`QuickAddCard`), чтобы после успешного добавления карточки:

1. **Прокручивать к добавленной карточке**
2. **Показывать анимацию `bounce-in-bck`** на добавленной карточке

## Success Criteria

- [ ] При нажатии на кнопку "Редактировать" в `CardItem.vue`:
  - [ ] Модалка редактирования показывается и загружает данные карточки
  - [ ] Фокус передаётся форме редактирования
- [ ] При сохранении изменений:
  - [ ] Отправляется запрос на бэкенд для обновления карточки
  - [ ] Прогресс и статус карточки сбрасывается (карточка становится новой)
  - [ ] Модалка редактирования скрывается
  - [ ] Список карточек прокручивается к отредактированной карточке
  - [ ] Отредактированная карточка показывает "puff" анимацию
- [ ] После добавления карточки через `QuickAddCard`:
  - [ ] Список карточек прокручивается к добавленной карточке
  - [ ] Добавленная карточка показывает "puff" анимацию
- [ ] Все изменения протестированы на desktop и mobile
- [ ] Документация обновлена

## Impact

- **Affected Files**:
  - `frontend/src/widgets/card-list/CardList.vue` (добавление метода прокрутки + bounce-анимации)
  - `frontend/src/pages/course/CoursePage.vue` (обработчик сохранения с прокруткой к карточке)
  - `backend/src/routes/cards.ts` (добавление параметра `resetProgress` в endpoint обновления)

- **Dependencies**:
  - Spec: `course-ui` (добавление требований к прокрутке и анимации карточек)
  - Backend API: `PUT /api/courses/:courseId/cards/:cardId` (расширение параметром `resetProgress`)

- **Estimated Complexity**: **Low** (1-2 часа разработки)

## Open Questions

1. **Сброс прогресса карточки**:
   - ✅ Сбрасываются поля: `state`, `stability`, `difficulty`, `reps`, `lapses`, `due`
   - ✅ Новая карточка получает `due` = текущее время + интервал повторения
   - ✅ Это часть endpoint `PUT /api/courses/:courseId/cards/:cardId` с параметром
     `resetProgress: true`

2. **Анимация**:
   - ✅ Используется `bounce-in-bck` анимация:

     ```css
     .anim-bounce-in-bck {
       animation-duration: 1s;
       animation-name: bounce-in-bck;
     }
     @keyframes bounce-in-bck {
       0% { opacity: 0; animation-timing-function: ease-in; transform: scale(7); }
       38% { opacity: 1; animation-timing-function: ease-out; transform: scale(1); }
       55% { animation-timing-function: ease-in; transform: scale(1.5); }
       72%, 89%, to { animation-timing-function: ease-out; transform: scale(1); }
       81% { animation-timing-function: ease-in; transform: scale(1.24); }
       95% { animation-timing-function: ease-in; transform: scale(1.04); }
     }
     ```

3. **Прокрутка к карточке**:
   - ✅ Используется `scrollIntoView({ behavior: 'smooth', block: 'start' })`

## Alternatives Considered

### Alternative 1: Создать новый inline компонент `CardEditForm`

**Pros**:
- Inline форма (видна в контексте страницы)
- Не требует дополнительного клика для открытия

**Cons**:
- Больше кода (новый компонент с дублированием логики `QuickAddCard`)
- Сложность управления видимостью форм на странице
- Не соответствует текущему паттерну редактирования (используется модалка)

**Decision**: Использовать существующий `CardEditorModal` с добавлением визуальной обратной связи
(прокрутка + анимация) после сохранения. Модалка уже исправлена и готова к использованию.

## Related Work

- Spec: `course-ui` — определяет UI требования к странице курса
- Change: Нет активных изменений
- Conversations: #94369661 (Finalizing Course Page UI)
