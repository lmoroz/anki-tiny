# Add Retention Settings

## Change ID

`add-retention-settings`

## Problem Statement

В настоящее время параметр `request_retention` (желаемая надежность памяти) жёстко зашит в FSRS сервисе со значением **0.9**. Это не позволяет пользователям выбирать интенсивность обучения согласно их целям и возможностям.

Дополнительно, UI настроек стал объёмным и требует организации в сворачиваемые секции для лучшей навигации.

## Proposed Solution

Добавить пользовательский выбор параметра **request_retention** как **"Интенсивность обучения"** с тремя предустановленными уровнями:

- **Low (Расслабленный режим)** = 0.80
- **Medium (Стандарт)** = 0.90 (по умолчанию)
- **High (Cramming)** = 0.95

Параметр будет доступен как в **глобальных настройках**, так и в **индивидуальных настройках** каждого курса.

Также реорганизовать UI настроек в **сворачиваемые секции** для улучшения UX.

## User Impact

### Positive

- Пользователи смогут настроить интенсивность обучения в зависимости от своих целей
- **Cramming режим** (0.95) подходит для экзаменов и быстрого запоминания
- **Расслабленный режим** (0.80) снижает нагрузку для долгосрочного обучения
- Улучшенная организация UI упростит навигацию в настройках

### Breaking Changes

**Нет**. Все существующие курсы будут использовать значение **0.90** по умолчанию (текущее поведение).

## Alternatives Considered

1. **Ручной ввод числового значения** (0.00-1.00)
   - ❌ Слишком сложно для пользователя
   - ❌ Требует понимания FSRS алгоритма

2. **5 уровней интенсивности** (Very Low / Low / Medium / High / Very High)
   - ❌ Избыточно, 3 уровня покрывают основные use cases

3. **Только глобальный параметр**
   - ❌ Не позволяет настроить разную интенсивность для разных курсов
   - ❌ Например: cramming для экзаменационного курса и relaxed для хобби

## Scope

### In Scope

- Добавление `requestRetention` в глобальные настройки (таблица `settings`)
- Добавление `requestRetention` в настройки курса (таблица `courseSettings`, nullable)
- Обновление FSRS сервиса для использования настраиваемого значения
- UI элемент (radio buttons или select) для выбора уровня интенсивности
- Реорганизация SettingsForm в сворачиваемые секции
- Миграция БД (добавление новых полей)

### Out of Scope

- Кастомные пользовательские формулы FSRS
- Продвинутая настройка остальных FSRS параметров (w-weights)
- Визуализация влияния retention на интервалы

## Dependencies

- Существующие спецификации:
  - `settings-global-management`
  - `settings-course-management`
  - `settings-ui`
- Backend: `fsrs/index.ts` (FSRS service)
- Frontend: `SettingsForm.vue`, `CourseSettingsModal.vue`

## Risks and Mitigations

| Risk                                               | Mitigation                                            |
| -------------------------------------------------- | ----------------------------------------------------- |
| Пользователи могут не понимать влияние retention   | Добавить tooltips с объяснением каждого уровня        |
| Неправильная миграция существующих данных          | Использовать дефолтное значение 0.90 для всех записей |
| Сворачиваемые секции могут скрыть важные настройки | Все секции открыты по умолчанию при первом посещении  |

## Open Questions

**Нет**. Все требования определены.
